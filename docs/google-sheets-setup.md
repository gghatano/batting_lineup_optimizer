# Google Sheets連携セットアップガイド

## 概要
野球打順最適化アプリをGoogle Sheetsと連携させ、リアルタイムで選手データを更新する方法を説明します。

## Google Sheetsの準備

### 1. スプレッドシート作成
1. Google Sheetsで新しいスプレッドシートを作成
2. 以下の形式でデータを入力

| 背番号 | 選手名 | 打率 | 試合 | 打席数 | 打数 | 得点 | 安打 | 二塁打 | 三塁打 | 本塁打 | 塁打 | 打点 | 盗塁 | 盗塁刺 | 犠打 | 犠飛 | 四球 | 敬遠 | 死球 | 三振 | 併殺打 | 出塁率 | 長打率 |
|--------|--------|------|------|--------|------|------|------|--------|--------|--------|------|------|------|--------|------|------|------|------|------|------|--------|--------|--------|
| 2 | 吉川 尚輝 | 0.278 | 87 | 374 | 331 | 28 | 92 | 13 | 3 | 3 | 120 | 26 | 7 | 2 | 1 | 3 | 35 | 0 | 4 | 51 | 6 | 0.351 | 0.363 |

### 2. 公開設定
1. 「共有」ボタンをクリック
2. 「リンクを知っている全員」に設定
3. 権限は「閲覧者」に設定
4. 「完了」をクリック
5. 共有リンクをコピー

### 3. URL形式
取得したURLは以下の形式になります：
```
https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit#gid=[SHEET_ID]
```

## アプリケーション設定

### 1. 環境変数設定
`.env.local`ファイルを作成し、以下を設定：

```bash
# リモートモードに切り替え
VITE_DATA_MODE=remote

# Google SheetsのURL
VITE_REMOTE_CSV_URL=https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID/edit#gid=0
```

### 2. 自動URL変換
アプリは自動的にGoogle SheetsのURLをCSV出力形式に変換します：

**変換前:**
```
https://docs.google.com/spreadsheets/d/1A2B3C4D5E6F7G8H9I0J/edit#gid=0
```

**変換後:**
```
https://docs.google.com/spreadsheets/d/1A2B3C4D5E6F7G8H9I0J/export?format=csv&gid=0
```

## データ更新フロー

1. **Google Sheetsでデータ更新** → 選手成績を最新データに更新
2. **アプリが自動取得** → 2分間隔でキャッシュを更新
3. **リアルタイム反映** → 新しいデータがアプリに表示

## トラブルシューティング

### CORSエラーが発生する場合
- Google Sheetsの公開設定を確認
- URLが正しい形式かチェック
- ブラウザのコンソールでエラー詳細を確認

### データが表示されない場合
1. `.env.local`の設定を確認
2. Google Sheetsのアクセス権限を確認
3. ヘッダー行（1行目）が正しい列名になっているか確認

### 接続エラーの場合
- ネットワーク接続を確認
- Google Sheetsサービスの状態を確認
- 開発者ツールのNetworkタブでリクエストエラーを確認

## 技術仕様

### リトライ機能
- **リトライ回数**: 3回（ローカル: 2回）
- **リトライ間隔**: 指数バックオフ（1秒→2秒→4秒）
- **対象エラー**: ネットワークエラー、タイムアウト

### キャッシュ設定
- **staleTime**: 2分（ローカル: 5分）
- **gcTime**: 10分
- **自動更新**: バックグラウンドでデータ更新

### サポートデータ形式
- CSVヘッダー必須
- 数値フィールド: 背番号、試合、打席数等
- 小数点フィールド: 打率、出塁率、長打率

## 本番デプロイ時の設定

GitHub Actionsでの環境変数設定：

```yaml
env:
  VITE_DATA_MODE: remote
  VITE_REMOTE_CSV_URL: ${{ secrets.GOOGLE_SHEETS_URL }}
```

Repository secretsに`GOOGLE_SHEETS_URL`を設定してください。